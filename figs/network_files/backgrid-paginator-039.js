!function(e,t){"object"==typeof exports?module.exports=t(require("underscore"),require("backbone"),require("backgrid"),require("backbone.paginator")):"function"==typeof define&&define.amd?define(["underscore","backbone","backgrid","backbone.paginator"],t):t(e._,e.Backbone,e.Backgrid)}(this,function(e,t,i){"use strict";var a=i.Extension.PageHandle=t.View.extend({tagName:"li",events:{"click a":"changePage"},title:function(e){return"Page "+e.label},isRewind:!1,isBack:!1,isForward:!1,isFastForward:!1,initialize:function(t){var i=this.collection,a=i.state,s=a.currentPage,r=a.firstPage,n=a.lastPage;e.extend(this,e.pick(t,["isRewind","isBack","isForward","isFastForward"]));var l;this.isRewind?l=r:this.isBack?l=Math.max(r,s-1):this.isForward?l=Math.min(n,s+1):this.isFastForward?l=n:(l=+t.pageIndex,l=r?l+1:l),this.pageIndex=l,this.label=(t.label||(r?l:l+1))+"";var o=t.title||this.title;this.title=e.isFunction(o)?o({label:this.label}):o},render:function(){this.$el.empty();var e=document.createElement("a");e.href="#",this.title&&(e.title=this.title),e.innerHTML=this.label,this.el.appendChild(e);var t=this.collection,i=t.state,a=i.currentPage,s=this.pageIndex;return this.isRewind&&a==i.firstPage||this.isBack&&!t.hasPreviousPage()||this.isForward&&!t.hasNextPage()||this.isFastForward&&(a==i.lastPage||i.totalPages<1)?this.$el.addClass("disabled"):this.isRewind||this.isBack||this.isForward||this.isFastForward||i.currentPage!=s||this.$el.addClass("active"),this.delegateEvents(),this},changePage:function(e){e.preventDefault();var t=this.$el,i=this.collection;return t.hasClass("active")||t.hasClass("disabled")||(this.isRewind?i.getFirstPage({reset:!0}):this.isBack?i.getPreviousPage({reset:!0}):this.isForward?i.getNextPage({reset:!0}):this.isFastForward?i.getLastPage({reset:!0}):i.getPage(this.pageIndex,{reset:!0})),this}}),s=i.Extension.Paginator=t.View.extend({className:"backgrid-paginator",windowSize:10,slideScale:.5,controls:{rewind:{label:"《",title:"First"},back:{label:"〈",title:"Previous"},forward:{label:"〉",title:"Next"},fastForward:{label:"》",title:"Last"}},renderIndexedPageHandles:!0,renderMultiplePagesOnly:!1,pageHandle:a,goBackFirstOnSort:!0,initialize:function(t){var i=this;i.controls=e.defaults(t.controls||{},i.controls,s.prototype.controls),e.extend(i,e.pick(t||{},"windowSize","pageHandle","slideScale","goBackFirstOnSort","renderIndexedPageHandles","renderMultiplePagesOnly"));var a=i.collection;i.listenTo(a,"add",i.render),i.listenTo(a,"remove",i.render),i.listenTo(a,"reset",i.render),i.listenTo(a,"backgrid:sorted",function(){i.goBackFirstOnSort&&a.state.currentPage!==a.state.firstPage&&a.getFirstPage({reset:!0})})},slideMaybe:function(e,t,i,a,s){return Math.round(i%a/a)},slideThisMuch:function(e,t,i,a,s){return~~(a*s)},_calculateWindow:function(){var e=this.collection,t=e.state,i=t.firstPage,a=+t.lastPage;a=Math.max(0,i?a-1:a);var s=Math.max(t.currentPage,t.firstPage);s=i?s-1:s;var r=this.windowSize,n=this.slideScale,l=Math.floor(s/r)*r;return s<=a-this.slideThisMuch()&&(l+=this.slideMaybe(i,a,s,r,n)*this.slideThisMuch(i,a,s,r,n)),[l,Math.min(a+1,l+r)]},makeHandles:function(){var t=[],i=this.collection,a=this._calculateWindow(),s=a[0],r=a[1];if(this.renderIndexedPageHandles)for(var n=s;n<r;n++)t.push(new this.pageHandle({collection:i,pageIndex:n}));var l=this.controls;return e.each(["back","rewind","forward","fastForward"],function(e){var a=l[e];if(a){var s={collection:i,title:a.title,label:a.label};s["is"+e.slice(0,1).toUpperCase()+e.slice(1)]=!0;var r=new this.pageHandle(s);"rewind"==e||"back"==e?t.unshift(r):t.push(r)}},this),t},render:function(){this.$el.empty();var e=this.collection.state.totalPages;if(this.renderMultiplePagesOnly&&e<=1)return this;if(this.handles)for(var t=0,i=this.handles.length;t<i;t++)this.handles[t].remove();for(var a=this.handles=this.makeHandles(),s=document.createElement("ul"),t=0;t<a.length;t++)s.appendChild(a[t].render().el);return this.el.appendChild(s),this}})});