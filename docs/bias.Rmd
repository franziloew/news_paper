---
title: "Different types of media bias"
subtitle: "Comparing bias measures"
author: "Franziska LÃ¶w"
date: "`r format(Sys.Date())`"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
rm(list = ls())
library(tidyverse)
library(ggthemes)

source("func/functions.R")
```

```{r}
load("../output/agendabias.Rda")
load("../output/sentbias.Rda")
load("../output/visbias.Rda")

agendaBias %>%
  left_join(., visBias, by = c("medium","party","date")) %>%
  left_join(., sentBias, by = c("medium","party","date")) -> bias
```

```{r}
bias %>%
  ungroup() %>%
  select(medium, party, date, agenda_bias_norm, vis_bias_norm, sent_bias_norm) %>%
  gather(bias, value, agenda_bias_norm:sent_bias_norm) -> biasDF
```

```{r}
biasDF %>%
  ggplot(aes(date, value, color = bias)) +
  geom_line(alpha=0.8) +
  #geom_text(aes(y = 0), size = 3) +
  theme_hc() +
  scale_color_gdocs(name=NULL,
                   breaks=c("vis_bias_norm", "sent_bias_norm", "agenda_bias_norm"),
                   labels=c("Visibility bias", "Tonality bias", "Agenda bias")) +
  facet_grid(party~medium) +
  labs(x = NULL, y = NULL) +
  #coord_flip() +
  #scale_y_continuous(breaks = c(-1,0,1), labels = c(-1,0,1)) +
  theme(axis.text = element_text(size = 7),
        axis.title = element_text(size = 7)
        )

ggsave("../figs/bias.png", width = 8, height = 6)
```

## 3. Compare with polls

We use the data from the "Sonntagsumfrage" (Sunday survey) from [infratest dimap](https://www.infratest-dimap.de/umfragen-analysen/bundesweit/sonntagsfrage/). The institution regularly asks at least 1000 German citizens the question: "Which party would you choose if federal elections take place next Sunday?" The survey thus measures the current election tendencies and therefore reflects an intermediate state in the opinion-forming process of the electoral population.

```{r}
# Import and prepare survey data
load("../output/polls.Rda")

polls <- table_long %>%
  dplyr::mutate(
    year = lubridate::year(Datum),
    month = lubridate::month(Datum),
    date = as.Date(paste0(year,"/",month,"/1"))
    
    )
```

```{r include=FALSE}
polls %>%
  filter(Datum > as.Date("2017-01-01")) %>%
  filter(!party %in% c("Piraten", "Sonstige")) %>%
  ggplot(aes(Datum, value,
             group = party,
             color = party)) +
  geom_line() +
  scale_color_manual(values =  c("deepskyblue", "gold", "limegreen", "deeppink", "red", "black")) +
  scale_x_date(breaks = date_breaks("1 month"), 
               labels=date_format("%b\n%y", tz="CET")) +
    geom_vline(xintercept = as.Date("2017-09-24"), 
             linetype = 2) +
  labs(x="", y="", color="",
       title = "",
       caption = "source: infratest dimap") +
    guides(color = guide_legend(nrow = 1,
                                label.theme = element_text(size = 10,
                                                           angle=0))) +
  theme(axis.text = element_text(size=10),
        legend.position = "bottom")

ggsave(filename = "../figs/polls.png", width = 6, height = 4, dpi = 600)
```

![Poll Results](../figs/polls.png)

### Normalization 

```{r}
polls_monthly <- polls %>%
  group_by(date,party) %>%
  dplyr::summarise(mean_val = mean(value, na.rm=T)) %>%
  ungroup() %>%
  filter(!party %in% c("Piraten", "Sonstige")) %>%
  filter(mean_val != "NaN") %>%
  select(party, date, mean_val) %>%
  filter(date > as.Date("2017-05-01")) %>%
  filter(date < as.Date("2018-03-01")) 
```

