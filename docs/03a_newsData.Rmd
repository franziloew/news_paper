---
title: "Online News"
subtitle: "Analysing online news from german media outlets"
author: "Franziska LÃ¶w"
date: "`r format(Sys.Date())`"
output: 
  html_document:
    code_folding: hide
---

```{r include=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
```

```{r include=FALSE}
# load the packages
libs <- c("readr","lubridate","tidyverse","data.table","stringr","scales","ggthemes","xtable")
lapply(libs, library, character.only = TRUE)

rm(list=ls())
#source("func/functions.R")

# Load Dataframes
visits <- read.csv("../data/visits", stringsAsFactors = FALSE) # visits
load("../output/data_step2.Rda")
```

# Visits

News sources used for the analysis including their respective number of articles and readers measured as Visits. As no advertising is permitted on the Tagesschau.de website in accordance with the Interstate Broadcasting Treaty, public data is difficult to find or compare. 

```{r}
visits %>%
  mutate(visits = visits/1000000) %>%
  ggplot(aes(reorder(medium, visits), visits)) +
  geom_col(alpha = 0.9) +
  theme_hc() +
  scale_fill_hc()+
  coord_flip() +
  labs(x="", y="Visits in million",
       caption="Source: AGOF daily digital facts\nINFOnline (tagesschau.de)")

#ggsave(filename = "../figs/visits.png", width = 6, height = 5)
```

# Articles

## Summary

Overview of news sources used for the analysis including...
  
  - Number of all articles, 
  - Share of articles about domestic politics within all articles during the period
  - Visits: Defined as the number of sessions within a given time period. 

```{r}
btw %>%
  group_by(medium) %>%
  summarize(num_articles = n()) -> politics
  
df_summary <- df %>%
  group_by(medium) %>%
  summarize(total_articles = n()) %>%
  left_join(., politics, by="medium") %>%
  mutate(share = num_articles/total_articles) %>%
  
  # combine with visits df
  left_join(., visits, by="medium") %>%
  select(medium, total_articles,share, visits)
```

```{r eval=FALSE, include=FALSE}
# Print out the summary dataframe to a latex table 
print(xtable(df_summary, 
             type="latex",
             caption ="News sources used for the analysis"
             ), include.rownames = F,
      file="../writing/tables/data_summary.tex" )
```

```{r}
btw %>%
  group_by(medium, date) %>%
  tally() %>%
  ggplot(aes(date, n,color = medium)) +
  geom_line() +
  # Election
  geom_vline(xintercept = as.POSIXct("2017-09-24"), linetype=2) +
  annotate(geom="text", x=as.POSIXct("2017-09-01"), 
           y=45, label="Election Date") +
  
  # failure of the Jamaica coalition talks
  geom_vline(xintercept = as.POSIXct("2017-11-19"), linetype=2) +
  
  annotate(geom="text", x=as.POSIXct("2017-11-25"), 
           y=45, label="Failure of Jamaica") +
  theme_hc() +
  scale_color_hc(name = NULL) +
  labs(x="",y="")

#ggsave(filename = "../figs/article_timeline.png", width = 7, height = 4)
```

## Wordclouds 

Before pre-processing:
```{r}
#png('wordcloud.png')
  
wordcloud::wordcloud(btw$title_text, max.words = 200)
  
#dev.off()
```

Pre-processed Data:

```{r}
#png('wordcloud_cleaned.png')
  
wordcloud::wordcloud(btw$text_cleaned1, max.words = 200)
  
#dev.off()
```

```{r eval=FALSE, include=FALSE}
medium <- unique(btw$medium)

for (i in medium) {
  png(paste0(i,'.png'))
  
  wordcloud::wordcloud(btw$text_cleaned1[btw$medium == i], min.freq = 00)
  
  dev.off()
  
}
```


